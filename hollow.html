<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hollow Knight Battle Game</title>
<style>
body { margin: 0; overflow: hidden; background-color: #1a1a1a; font-family: sans-serif; }
canvas { display: block; background-color: #222; }
#mainMenu, #characterMenu, #mapMenu, #teamMenu, #bottomMenu, #controlsMenu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #111; }
#teamMenu, #controlsMenu { display: none; }
#bottomMenu { top: auto; bottom: 0; height: 80px; flex-direction: row; justify-content: space-between; background: #111; }
#mainMenu h1, #characterMenu h1, #mapMenu h1, #teamMenu h1, #controlsMenu h1 { color: white; margin-bottom: 20px; }
.character-select, .map-select, .team-select { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
.character-button, .map-button, .menu-button { width: 80px; height: 80px; border-radius: 10px; background-color: #333; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer; transition: 0.2s; }
.character-button:hover, .map-button:hover, .menu-button:hover { transform: scale(1.1); background-color: #555; }
.character-button.selected, .map-button.selected { border: 3px solid yellow; }
#startButton, #selectMapButton, #confirmTeamButton { padding: 15px 30px; font-size: 22px; cursor: pointer; border-radius: 10px; background-color: #444; color: white; border: none; box-shadow: 0 5px #222; transition: 0.1s; }
#startButton:active, #selectMapButton:active, #confirmTeamButton:active { box-shadow: 0 2px #222; transform: translateY(3px); }
.bottom-button { flex: 1; margin: 0; height: 100%; font-size: 24px; background-color: #444; color: white; border: none; cursor: pointer; }
.bottom-button:hover { background-color: #666; }
</style>
</head>
<body>

<div id="mainMenu">
<h1>Hollow Knight Battle</h1>
<div style="display:flex; width: 100%; justify-content: center; gap: 50px;"><button class="menu-button" id="battleButton">Battle</button><button class="menu-button" id="forumsButton">Forums</button></div>
</div>

<div id="characterMenu" style="display:none;">
<h1>Select Your Characters</h1>
<div>Player 1 Select:</div>
<div id="p1Select" class="character-select"></div>
<div>Player 2 Select:</div>
<div id="p2Select" class="character-select"></div>
<button id="startButton">Next: Select Map</button>
</div>

<div id="mapMenu" style="display:none;">
<h1>Select Map</h1>
<div class="map-select" id="mapSelect"></div>
<button id="selectMapButton">Start Battle</button>
</div>

<div id="teamMenu">
<h1>Team Selection</h1>
<div>Player 1 Team:</div>
<div id="p1TeamSelect" class="team-select"></div>
<div>Player 2 Team:</div>
<div id="p2TeamSelect" class="team-select"></div>
<button id="confirmTeamButton">Confirm Teams</button>
</div>

<div id="controlsMenu">
<h1>Controls</h1>
<p>Player 1: Move - A/D, Jump - W, Attack - Q, Special - E</p>
<p>Player 2: Move - Arrow Keys, Jump - Up, Attack - N, Special - M</p>
<button id="closeControlsButton">Close</button>
</div>

<div id="bottomMenu">
<button class="bottom-button" id="controlsButton">Controls</button>
<button class="bottom-button" id="teamButton">Team</button>
</div>

<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const GRAVITY = 0.8;

class Character {
    constructor(name, x, y, color, attackKey, specialKey, imgSrc) {
        this.name = name;
        this.x = x; this.y = y; this.width = 50; this.height = 70; this.color = color;
        this.vx = 0; this.vy = 0; this.speed = 6; this.jumping = false; this.health = 100;
        this.activeAttack = null; this.facing = 1;
        this.attackKey = attackKey; this.specialKey = specialKey;
        this.specialProgress = 0; this.specialMax = 100;
        this.img = new Image(); this.img.src = imgSrc; this.imgLoaded = false;
        this.img.onload = () => { this.imgLoaded = true; };
    }
    draw() {
        if(this.imgLoaded){ ctx.drawImage(this.img,this.x,this.y,this.width,this.height); }
        else { ctx.fillStyle = this.color; ctx.fillRect(this.x,this.y,this.width,this.height); }
        ctx.fillStyle='red'; ctx.fillRect(this.x,this.y-20,this.width*(this.health/100),5);
        ctx.strokeStyle='yellow'; ctx.lineWidth=4;
        ctx.beginPath(); ctx.arc(this.x+this.width/2,this.y-40,15,0,2*Math.PI); ctx.stroke();
        ctx.beginPath(); ctx.arc(this.x+this.width/2,this.y-40,15,-Math.PI/2,-Math.PI/2+2*Math.PI*(this.specialProgress/this.specialMax)); ctx.stroke();
        if(this.activeAttack) this.activeAttack.draw();
    }
    update() {
        this.vy += GRAVITY; this.y += this.vy; this.x += this.vx;
        if(this.x<0) this.x=0; if(this.x+this.width>canvas.width)this.x=canvas.width-this.width;
        if(this.y+this.height>canvas.height){this.y=canvas.height-this.height;this.vy=0;this.jumping=false;}
        if(this.vx!==0)this.facing = this.vx>0?1:-1;
        if(this.activeAttack){this.activeAttack.update(); if(this.activeAttack.finished)this.activeAttack=null;}
    }
}

class Slash { constructor(x,y,length,color,duration,facing,owner){this.x=x;this.y=y;this.length=length;this.color=color;this.duration=duration;this.frame=0;this.finished=false;this.facing=facing; this.owner=owner;} draw(){if(this.finished)return;ctx.strokeStyle=this.color;ctx.lineWidth=6;ctx.beginPath();ctx.moveTo(this.x,this.y);ctx.lineTo(this.x+this.length*this.facing,this.y); ctx.stroke();} update(){this.frame++; if(this.frame>=this.duration)this.finished=true;} }

const charactersData=[
  {name:'Knight',color:'white',attack:'q',special:'e',img:'knight.png'},
  {name:'Hornet',color:'pink',attack:'q',special:'e',img:'hornet.png'},
  {name:'Dung Defender',color:'green',attack:'q',special:'e',img:'dung_defender.png'},
  {name:'False Knight',color:'gray',attack:'q',special:'e',img:'false_knight.png'},
  {name:'Quirl',color:'orange',attack:'q',special:'e',img:'quirl.png'},
  {name:'Traitor Lord',color:'purple',attack:'q',special:'e',img:'traitor_lord.png'}
];

let player1Team = [], player2Team = [], player1, player2, player1Index=0, player2Index=0;
let projectiles=[]; let selectedMap='default';

function createTeamButtons(containerId, playerTeam){
    const container=document.getElementById(containerId);
    charactersData.forEach(c=>{
        const btn=document.createElement('button'); btn.classList.add('character-button'); btn.textContent=c.name;
        btn.addEventListener('click',()=>{
            if(playerTeam.length<5){
                playerTeam.push(c);
                btn.classList.add('selected');
            }
        });
        container.appendChild(btn);
    });
}

createTeamButtons('p1TeamSelect', player1Team);
createTeamButtons('p2TeamSelect', player2Team);

document.getElementById('teamButton').addEventListener('click', ()=>{
    document.getElementById('teamMenu').style.display='flex';
    document.getElementById('bottomMenu').style.display='none';
});

document.getElementById('controlsButton').addEventListener('click', ()=>{
    document.getElementById('controlsMenu').style.display='flex';
    document.getElementById('bottomMenu').style.display='none';
});

document.getElementById('closeControlsButton').addEventListener('click', ()=>{
    document.getElementById('controlsMenu').style.display='none';
    document.getElementById('bottomMenu').style.display='flex';
});

function startBattle(){
    document.getElementById('bottomMenu').style.display='none';
    if(player1Team.length>0 && player2Team.length>0){
        player1 = new Character(player1Team[0].name, 100, canvas.height-100, player1Team[0].color,'q','e',player1Team[0].img);
        player2 = new Character(player2Team[0].name, canvas.width-150, canvas.height-100, player2Team[0].color,'n','m',player2Team[0].img);
        gameLoop();
    }
}

document.getElementById('confirmTeamButton').addEventListener('click', startBattle);

// Remaining gameLoop, controls, and damage logic stay the same...
</script>
</body>
</html>
