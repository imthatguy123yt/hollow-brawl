<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hollow Knight Battle Game – Squad Strike Edition</title>
<style>
body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: sans-serif; }
canvas { display: block; background: #222; }
.menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #111; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; }
.big-button { width: 33.33%; height: 120px; background: #333; color: white; font-size: 32px; border: none; cursor: pointer; }
#bottomMenu { position: absolute; bottom: 0; left: 0; width: 100%; display: flex; }
.character-grid, .team-grid { display: grid; grid-template-columns: repeat(3, 120px); gap: 10px; }
.character-btn, .team-btn { width: 120px; height: 120px; background: #333; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; border-radius: 10px; border: 3px solid transparent; font-size: 18px; }
.character-btn.selected, .team-btn.selected { border-color: yellow; }
.hide { display: none !important; }
</style>
</head>
<body>

<div id="mainMenu" class="menu">
    <h1>Hollow Fight</h1>
    <button class="big-button" id="battleButton">Battle</button>
    <button class="big-button" onclick="window.open('https://sites.google.com/tiftschools.com/hollow-fight/forums','_blank')">Forums</button>
    <button class="big-button" id="teamModeButton">Team Mode</button>
</div>

<div id="characterMenu" class="menu hide">
    <h1>Select Characters (1v1)</h1>
    <div id="p1Select" class="character-grid"></div>
    <div id="p2Select" class="character-grid"></div>
    <button id="confirmCharacters">Confirm</button>
</div>

<div id="teamMenu" class="menu hide">
    <h1>Squad Strike – Pick up to 5 each</h1>
    <h2>Player 1</h2>
    <div id="p1Team" class="team-grid"></div>
    <h2>Player 2</h2>
    <div id="p2Team" class="team-grid"></div>
    <button id="confirmTeams">Confirm Teams</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const charactersData = [
    { name: 'Knight', color: 'white' },
    { name: 'Hornet', color: 'pink' },
    { name: 'Dung Defender', color: 'orange' },
    { name: 'False Knight', color: 'gray' },
    { name: 'Quirl', color: 'lightblue' },
    { name: 'Traitor Lord', color: 'purple' }
];

// UI elements
const mainMenu = document.getElementById('mainMenu');
const characterMenu = document.getElementById('characterMenu');
const teamMenu = document.getElementById('teamMenu');

// Character buttons
function createCharacterButtons(container, arr, limit) {
    charactersData.forEach(char => {
        const btn = document.createElement('div');
        btn.className = 'team-btn';
        btn.textContent = char.name;
        btn.onclick = () => {
            if (!arr.includes(char)) {
                if (arr.length >= limit) return;
                arr.push(char);
                btn.classList.add('selected');
            } else {
                arr.splice(arr.indexOf(char), 1);
                btn.classList.remove('selected');
            }
        };
        document.getElementById(container).appendChild(btn);
    });
}

let player1Team = [];
let player2Team = [];

createCharacterButtons('p1Team', player1Team, 5);
createCharacterButtons('p2Team', player2Team, 5);

// Buttons
const teamModeButton = document.getElementById('teamModeButton');
const confirmTeams = document.getElementById('confirmTeams');

tteamModeButton.onclick = () => {
    mainMenu.classList.add('hide');
    teamMenu.classList.remove('hide');
};

confirmTeams.onclick = () => {
    if (player1Team.length === 0 || player2Team.length === 0) {
        alert('Both players must pick at least 1 character!');
        return;
    }
    teamMenu.classList.add('hide');
    startTeamBattle();
};

// GAME ENGINE
class Character {
    constructor(data, x, controls) {
        this.name = data.name;
        this.color = data.color;
        this.x = x;
        this.y = canvas.height - 150;
        this.width = 60;
        this.height = 90;
        this.vx = 0;
        this.vy = 0;
        this.speed = 6;
        this.health = 100;
        this.jumping = false;
        this.facing = 1;
        this.controls = controls;
        this.attackActive = false;
    }
    draw() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
        ctx.fillStyle = 'red';
        ctx.fillRect(this.x, this.y - 15, this.width * (this.health / 100), 8);
    }
    update() {
        this.vy += 1;
        this.y += this.vy;
        this.x += this.vx;
        if (this.y + this.height > canvas.height) {
            this.y = canvas.height - this.height;
            this.vy = 0;
            this.jumping = false;
        }
    }
}

let p1Index = 0;
let p2Index = 0;
let player1, player2;

function spawnCharacters() {
    player1 = new Character(player1Team[p1Index], 200, { left: 'a', right: 'd', jump: 'w', attack: 'q' });
    player2 = new Character(player2Team[p2Index], canvas.width - 300, { left: 'arrowleft', right: 'arrowright', jump: 'arrowup', attack: 'n' });
}

function nextCharacter(player) {
    if (player === 1) {
        p1Index++;
        if (p1Index >= player1Team.length) endGame(2);
        else spawnCharacters();
    } else {
        p2Index++;
        if (p2Index >= player2Team.length) endGame(1);
        else spawnCharacters();
    }
}

function endGame(winner) {
    alert('Player ' + winner + ' wins!');
    location.reload();
}

// Controls
const keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

function handleControls() {
    // P1 movement
    player1.vx = 0;
    if (keys[player1.controls.left]) player1.vx = -player1.speed;
    if (keys[player1.controls.right]) player1.vx = player1.speed;
    if (keys[player1.controls.jump] && !player1.jumping) {
        player1.vy = -20;
        player1.jumping = true;
    }
    if (keys[player1.controls.attack]) player2.health -= 1;

    // P2 movement
    player2.vx = 0;
    if (keys[player2.controls.left]) player2.vx = -player2.speed;
    if (keys[player2.controls.right]) player2.vx = player2.speed;
    if (keys[player2.controls.jump] && !player2.jumping) {
        player2.vy = -20;
        player2.jumping = true;
    }
    if (keys[player2.controls.attack]) player1.health -= 1;
}

function startTeamBattle() {
    spawnCharacters();
    requestAnimationFrame(gameLoop);
}

function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    handleControls();
    player1.update();
    player2.update();
    player1.draw();
    player2.draw();
    if (player1.health <= 0) nextCharacter(1);
    if (player2.health <= 0) nextCharacter(2);
    requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
