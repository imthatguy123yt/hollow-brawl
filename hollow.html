<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hollow Knight Battle Game</title>
<style>
body { margin: 0; overflow: hidden; background-color: #1a1a1a; font-family: sans-serif; }
canvas { display: block; background-color: #222; }
#menu, #mapMenu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #111; }
#menu h1, #mapMenu h1 { color: white; margin-bottom: 20px; }
.character-select, .map-select { display: flex; gap: 10px; margin-bottom: 20px; }
.character-button, .map-button { width: 80px; height: 80px; border-radius: 10px; background-color: #333; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer; }
.character-button.selected, .map-button.selected { border: 3px solid yellow; }
#startButton, #selectMapButton { padding: 15px 30px; font-size: 22px; cursor: pointer; border-radius: 10px; background-color: #444; color: white; border: none; box-shadow: 0 5px #222; }
#startButton:active, #selectMapButton:active { box-shadow: 0 2px #222; transform: translateY(3px); }
</style>
</head>
<body>
<div id="menu">
<h1>Hollow Knight Battle Game</h1>
<div>Player 1 Select:</div>
<div id="p1Select" class="character-select"></div>
<div>Player 2 Select:</div>
<div id="p2Select" class="character-select"></div>
<button id="startButton">Next: Select Map</button>
</div>

<div id="mapMenu" style="display:none;">
<h1>Select Map</h1>
<div class="map-select" id="mapSelect"></div>
<button id="selectMapButton">Start Battle</button>
</div>

<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const GRAVITY = 0.8;

class Character {
    constructor(name, x, y, color, attackKey, specialKey, imgSrc) {
        this.name = name;
        this.x = x; this.y = y; this.width = 40; this.height = 60; this.color = color;
        this.vx = 0; this.vy = 0; this.speed = 5; this.jumping = false; this.health = 100;
        this.hitsLanded = 0; this.canSpecial = false; this.activeAttack = null; this.facing = 1;
        this.attackKey = attackKey; this.specialKey = specialKey;
        this.specialProgress = 0; this.specialMax = 100;
        this.img = new Image(); this.img.src = imgSrc; this.imgLoaded = false;
        this.img.onload = () => { this.imgLoaded = true; };
    }
    draw() {
        if(this.imgLoaded){ ctx.drawImage(this.img,this.x,this.y,this.width,this.height); }
        else { ctx.fillStyle = this.color; ctx.fillRect(this.x,this.y,this.width,this.height); }
        ctx.fillStyle='red'; ctx.fillRect(this.x,this.y-20,this.width*(this.health/100),5);
        ctx.strokeStyle='yellow'; ctx.lineWidth=4;
        ctx.beginPath(); ctx.arc(this.x+this.width/2,this.y-40,15,0,2*Math.PI); ctx.stroke();
        ctx.beginPath(); ctx.arc(this.x+this.width/2,this.y-40,15,0,2*Math.PI*(this.specialProgress/this.specialMax)); ctx.stroke();
        if(this.activeAttack) this.activeAttack.draw();
    }
    update() {
        this.vy += GRAVITY; this.y += this.vy; this.x += this.vx;
        if(this.x<0) this.x=0; if(this.x+this.width>canvas.width)this.x=canvas.width-this.width;
        if(this.y+this.height>canvas.height){this.y=canvas.height-this.height;this.vy=0;this.jumping=false;}
        if(this.vx!==0)this.facing = this.vx>0?1:-1;
        if(this.activeAttack){this.activeAttack.update(); if(this.activeAttack.finished)this.activeAttack=null;}
    }
}

class Slash { constructor(x,y,length,color,duration,facing){this.x=x;this.y=y;this.length=length;this.color=color;this.duration=duration;this.frame=0;this.finished=false;this.facing=facing;} draw(){if(this.finished)return;ctx.strokeStyle=this.color;ctx.lineWidth=6;ctx.beginPath();ctx.moveTo(this.x,this.y);ctx.lineTo(this.x+this.length*this.facing,this.y);ctx.stroke();} update(){this.frame++; if(this.frame>=this.duration)this.finished=true;}}
class Projectile { constructor(x,y,vx,vy,radius,color){this.x=x;this.y=y;this.vx=vx;this.vy=vy;this.radius=radius;this.color=color;this.finished=false;} draw(){ctx.fillStyle=this.color; ctx.beginPath(); ctx.arc(this.x,this.y,this.radius,0,Math.PI*2); ctx.fill();} update(){this.x+=this.vx; this.y+=this.vy; if(this.x<0||this.x>canvas.width||this.y>canvas.height)this.finished=true;}}

const charactersData=[
  {name:'Knight',color:'white',attack:'q',special:'e',img:'knight.png'},
  {name:'Hornet',color:'pink',attack:'q',special:'e',img:'hornet.png'},
  {name:'Dung Defender',color:'green',attack:'q',special:'e',img:'dung_defender.png'},
  {name:'False Knight',color:'gray',attack:'q',special:'e',img:'false_knight.png'},
  {name:'Quirl',color:'orange',attack:'q',special:'e',img:'quirl.png'},
  {name:'Traitor Lord',color:'purple',attack:'q',special:'e',img:'traitor_lord.png'}
];

let player1,player2; let projectiles=[]; let selectedMap='default';

function createCharacterButtons(containerId,playerNumber){
    const container=document.getElementById(containerId);
    charactersData.forEach(c=>{
        const btn=document.createElement('button'); btn.classList.add('character-button'); btn.textContent=c.name;
        btn.addEventListener('click',()=>{
            document.querySelectorAll(`#${containerId} .character-button`).forEach(b=>b.classList.remove('selected'));
            btn.classList.add('selected');
            if(playerNumber===1)player1=new Character(c.name,100,canvas.height-100,c.color,'q','e',c.img);
            else player2=new Character(c.name,canvas.width-150,canvas.height-100,c.color,'n','m',c.img);
        });
        container.appendChild(btn);
    });
}
createCharacterButtons('p1Select',1);
createCharacterButtons('p2Select',2);

const maps=['Forest','Ruins','Deepnest'];
const mapSelect=document.getElementById('mapSelect');
maps.forEach(m=>{
    const btn=document.createElement('button'); btn.classList.add('map-button'); btn.textContent=m;
    btn.addEventListener('click',()=>{document.querySelectorAll('#mapSelect .map-button').forEach(b=>b.classList.remove('selected')); btn.classList.add('selected'); selectedMap=m;});
    mapSelect.appendChild(btn);
});

const keys={};
document.addEventListener('keydown',e=>{keys[e.key.toLowerCase()]=true;});
document.addEventListener('keyup',e=>{keys[e.key.toLowerCase()]=false;});

function handleControls(){
    if(player1){player1.vx=keys['a']?-player1.speed:keys['d']?player1.speed:0;
        if(keys['w']&&!player1.jumping){player1.vy=-15;player1.jumping=true;}
        if(keys[player1.attackKey]){if(!player1.activeAttack)player1.activeAttack=new Slash(player1.x+player1.width/2,player1.y+player1.height/2,50,'yellow',15,player1.facing); player1.specialProgress+=10;}
    }
    if(player2){player2.vx=keys['arrowleft']?-player2.speed:keys['arrowright']?player2.speed:0;
        if(keys['arrowup']&&!player2.jumping){player2.vy=-15;player2.jumping=true;}
        if(keys[player2.attackKey]){if(!player2.activeAttack)player2.activeAttack=new Slash(player2.x+player2.width/2,player2.y+player2.height/2,50,'cyan',15,player2.facing); player2.specialProgress+=10;}
    }
}

function checkDamage(attacker, defender){
    if(attacker.activeAttack){
        let ax1=attacker.activeAttack.x;
        let ax2=attacker.activeAttack.x + attacker.activeAttack.length * attacker.activeAttack.facing;
        let ay=attacker.activeAttack.y;
        let dx1=defender.x;
        let dx2=defender.x + defender.width;
        let dy1=defender.y;
        let dy2=defender.y + defender.height;
        if(ax2 > dx1 && ax1 < dx2 && ay > dy1 && ay < dy2){ defender.health -= 1; }
    }
}

function gameLoop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    handleControls();
    if(player1){player1.update(); player1.draw();}
    if(player2){player2.update(); player2.draw();}
    checkDamage(player1, player2);
    checkDamage(player2, player1);
    projectiles.forEach(p=>{p.update();p.draw();});
    projectiles=projectiles.filter(p=>!p.finished);
    requestAnimationFrame(gameLoop);
}

document.getElementById('startButton').addEventListener('click',()=>{
    if(player1&&player2){document.getElementById('menu').style.display='none'; document.getElementById('mapMenu').style.display='flex';}
    else alert('Both players must select a character!');
});
document.getElementById('selectMapButton').addEventListener('click',()=>{
    if(selectedMap){ document.getElementById('mapMenu').style.display='none'; gameLoop(); }
    else alert('Select a map!');
});
</script>
</body>
</html>
